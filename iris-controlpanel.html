<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iris-polymer-importer/iris-importer.html">
<link rel="import" href="../../bower_components/iris-polymer-usercard/iris-usercard.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iris-polymer-queuelist/iris-queuelist.html">


<dom-module id="iris-controlpanel">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        display: block;
        --paper-card-header-text: {
          font-size: 12pt;
          text-align: center;
          padding: 0;
          margin: 0;
        }
        --paper-card-content: {
          font-size: 12pt;
          text-align: center;
        }
      }
      
      .data-tier > div {
        width: 50%;
      }
      
      #main-info > div {
        height: 250px;
      }
      
      .data-tier paper-card {
        width: 100%;
        height: 30%;
        margin-bottom: 3%;
      }
      
      .data-tier paper-card paper-button {
        --paper-button: {
          @apply(--layout-vertical);
          @apply(--layout-center-center);
        }
        ;
      }
      
      paper-material {
        padding: 5px 5%;
      }
      
      paper-button iron-icon {
        margin-top: -2px;
      }
    </style>

    <iris-usercard on-menu="menuAction" api="{{api}}">
      <paper-button>Перерыв</paper-button>
      <paper-button>Завершить работу</paper-button>
    </iris-usercard>


    <paper-material>
      <div class="button-tier layout horizontal">
        <paper-button class="flex" on-click="next">Следующий</paper-button>
        <paper-button class="flex" on-click="list">
          Список талонов
          <iron-icon icon="icons:list">
        </paper-button>
      </div>
    </paper-material>

    <paper-material id="main-info" class="data-tier layout horizontal  around-justified">
      <div class="layout vertical">
        <paper-card elevation="0" heading="Вызван:">
          <div class="card-content">Some content</div>
        </paper-card>
        <paper-card elevation="0" heading="Услуга:">
          <div class="card-content">Some content</div>
        </paper-card>
        <paper-card elevation="0" heading="ФИО:">
          <div class="card-content">Some content</div>
        </paper-card>
      </div>
      <div class="layout vertical">
        <paper-card elevation="0" heading="Время обслуживания:">
          <div class="card-content">Some content</div>
        </paper-card>
        <paper-card elevation="0">
          <div class="card-content">
            <paper-button raised on-click="retry">Повтор вызова</paper-button>
          </div>
        </paper-card>
        <paper-card elevation="0">
          <div class="card-content">
            <paper-button raised on-click="redirect">Передать</paper-button>
          </div>
        </paper-card>
      </div>
    </paper-material>

    <paper-material>
      <div class="button-tier layout horizontal">
        <paper-button class="flex">Отложить</paper-button>
        <paper-button class="flex">Список отложенных</paper-button>
      </div>
    </paper-material>

    <paper-material class="data-tier layout horizontal  around-justified">
      <paper-card elevation="0" heading="В очереди">
        <div class="card-content">{{inqueue_count}}</div>
      </paper-card>
      <paper-card elevation="0" heading="Отложено">
        <div class="card-content">{{postponed_count}}</div>
      </paper-card>
    </paper-material>

  </template>

  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'iris-controlpanel',
        properties: {
          api: Object
        },
        ready() {
          this.queue = this.api.require('queue');
          this.request_in_progress = false;
          this.inqueue_count = 0;
          this.postponed_count = 0;

          setInterval(() => {
            this.inqueue_count = parseInt(Math.random() * 400);
            this.postponed_count = parseInt(Math.random() * 100);
          }, 1500);

          let user = this.api.require('user');

          user.on('user.fields.changed', () => {
            if (user.isLogged()) {
              this.queue.on('queue.update', (queuedata) => {
                this.set('inqueue_count', queuedata.status.in_queue);
                this.set('postponed_count', queuedata.status.postponed);
              });
            } else {
              then.queue.off('queue.update');
            }
          });
        },
        next() {
          let next = this.queue.getNextTicket();
        },
        specific(ticket) {
          let specific = this.queue.getSpecificTicket(ticket);
        },
        postpone() {

        },
        redirect(route) {

        },
        close() {

        },
        retry() {

        },
        menuAction() {
          console.log('menuAction');
        }
      });
    })();
  </script>

</dom-module>