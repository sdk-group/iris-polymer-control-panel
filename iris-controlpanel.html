<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iris-polymer-importer/iris-importer.html">

<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="../../bower_components/iris-polymer-usercard/iris-usercard.html">
<link rel="import" href="../../bower_components/iris-polymer-queuecard/iris-queuecard.html">
<link rel="import" href="../../bower_components/iris-polymer-doomclock/iris-doomclock.html">
<link rel="import" href="../../bower_components/iris-polymer-ticketview/iris-ticketview.html">

<dom-module id="iris-controlpanel">
  <template>
    <style include="shared-styles"></style>
    <style>
      :host {
        display: block;
        --paper-card-header-color: #702c0c;
      }
      
      #main-info > div {
        height: 250px;
      }
      
      paper-button iron-icon {
        margin-top: -2px;
      }
      
      .cards>::content iris-queuecard {
        margin-right: 10px;
        margin-top: 10px;
        @apply(--layout-flex);
        min-width: 200px;
      }
      
      .cards>::content paper-card .items-counter {
        font-size: 24px;
        padding: 10px;
      }
      
      paper-card:last-child {
        margin-right: 0;
      }
      
      iris-ticketactions {
        padding-top: 15px;
      }
      
      .doomclcok .card-content {
        font-size: 24px;
        text-align: center;
      }
      
      paper-card.doomclcok {
        margin-top: 10px;
        @apply(--layout-flex-2);
        min-width: 250px;
      }
    </style>

    <iron-meta id="meta"></iron-meta>

    <div class="ticket-actions-interceptor" on-ticket-action="ticketAction">
      <div class="cards layout horizontal wrap center-justified">
        <content select="iris-queuecard"></content>
        <paper-card class="doomclcok" heading="Время ожидания">
          <div class="card-content">
            <iris-doomclock></iris-doomclock>
          </div>
        </paper-card>
      </div>
      <iris-ticketview view="stateful">
        <paper-card class=" ticket-action flexchild layout vertical">
          <paper-button action="next" class="btn-primary" raised elevation="0"> Следующий </paper-button>
          <paper-button action="come" class="btn-primary" raised elevation="0"> Подошел </paper-button>
          <paper-button action="retry" class="btn-primary" disabled raised elevation="0"> Повтор вызова </paper-button>
          <paper-button action="postpone" class="btn-primary" raised elevation="0"> Отложить </paper-button>
          <paper-button action="route" class="btn-primary" raised elevation="0"> Передать </paper-button>
        </paper-card>
      </iris-ticketview>
    </div>
  </template>

  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'iris-controlpanel',
        properties: {},
        ready() {
          let api = this.$.meta.byKey('api');
          this.queue = api.require('queue');
          this.request_in_progress = false;

          let user = api.require('user');

          user.on('user.fields.changed', () => {
            if (user.isLogged()) {

            } else {
              then.queue.off('queue.update');
            }
          });
        },
        next() {
          let next = this.queue.getNextTicket();
        },
        specific(ticket) {
          let specific = this.queue.getSpecificTicket(ticket);
        },
        postpone() {

        },
        redirect(route) {

        },
        close() {

        },
        retry() {

        },
        menuAction() {
          console.log('menuAction');
        },
        ticketAction(e) {
          let data = e.detail;

          let ticket = data.ticket;
          let action = data.action;
          console.log(ticket, action);
        }
      });
    })();
  </script>

</dom-module>