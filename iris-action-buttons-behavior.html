<script>
  (function() {
    'use strict'

    window.IrisBehaviors = window.IrisBehaviors || {};

    IrisBehaviors.ActionButtonsBehvior = {
      getActionName(str) {
        let name = _.upperFirst(_.camelCase(str));
        return `action${name}`
      },
      actionNext(ticket) {
        return this.$.workstation.getNext();
      },
      actionCallAgain(ticket) {
        return ticket.callAgain().finally(() => this.$.viewer.restoreButtonsState());
      },
      actionRoute(ticket) {
        let mock_ticket = {
          service: "service-1",
          getId() {
            return 'ticket-department-1-2016-05-24--0'
          }
        };
        let requestRouts = this.$.workstation.getAvailableRoutes(mock_ticket);

        return requestRouts.then((data) => {
          return this.$.routing.show(data, mock_ticket)
        }).then((route) => {
          if (!route) return false;

          //NOTE@: MOCK!
          return console.log('Routing to:', route);

          return this.$.workstation.routeTicket(ticket, route);
        }).finally(() => this.$.viewer.restoreButtonsState());
      },
      actionProcess(ticket) {
        return this.$.workstation.getTicketById(ticket);
      },
      actionPostpone(ticket) {
        return this.$.workstation.postponeTicket(ticket);
      },
      actionDefault(ticket, action) {
        return this.$.workstation.performTicketAction(ticket, action);
      },
      doAction(ticket, action) {
        let name = this.getActionName(action);
        return _.isFunction(this[name]) ? this[name](ticket) : this.actionDefault(ticket, action)
      }
    };

  })();
</script>
